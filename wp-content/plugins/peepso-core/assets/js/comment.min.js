!function(e,t,n){t.comment=new(function(e,t){function n(){this.init()}return t.npm.objectAssign(n.prototype,{init:function(){this.ajax={},e(e.proxy(function(){var t=(window.location.hash||"").match(/[#&]comment(?:\.|=)(\d+)\.(\d+)(?:\.(\d+)(?:\.(\d+))?)?/);t&&t[2]&&this.whenLoaded(t[1]).done(e.proxy(function(){this.reveal(t[1],t[2],t[3],t[4])},this))},this))},whenLoaded:function(t){return e.Deferred(function(n){var o,i=0;o=setInterval(function(){e(".ps-js-activity--"+t).length?(clearInterval(o),n.resolve()):i++>60&&(clearInterval(o),n.reject())},1e3)})},add:function(){},edit:function(){},reply:function(t,n,o,i){var s,r,c,a="#comment-item-"+n;c=(s=(o?e(o).closest(a):e(a)).find(".actaction-reply")).closest(".ps-comment").hasClass("ps-comment-nested")?(r=s.closest(".ps-comment").children(".ps-comment-reply")).find("textarea"):(r=s.closest(".ps-comment-item").next(".ps-comment-nested").children(".ps-comment-reply")).find("textarea"),r.not(":visible")&&r.show(),c.focus(),i=i||{},ps_observer.apply_filters("comment.reply",c,e.extend({},i,{act_id:t,post_id:n})),c.off("keyup.peepso").on("keyup.peepso",function(e){e.stopPropagation(),activity.update_beautifier(e.target)}).trigger("keyup.peepso")},show_previous:function(n,o){var i,s,r,c=".ps-js-comment-container--"+n;return i=o?e(o).closest(c):e(c),s=i.find(".ps-js-comment-more"),r=s.find(".ps-js-loading"),e.Deferred(function(o){var c,a;c=function(){o.resolve()},a=i.children(".cstream-comment:first"),r.removeClass("hidden"),t.postJson("activity.show_previous_comments",{act_id:n,uid:peepsodata.currentuserid,first:a.data("comment-id")},function(n){var o=t.observer.applyFilters("peepso_activity_content",n.data.html);r.addClass("hidden"),a.before(o),n.data.comments_remain>0?s.find("a").html(n.data.comments_remain_caption):s.remove(),e(document).trigger("ps_comment_added"),c()})})},show_all:function(n){var o=e(".ps-js-comment-container--"+n),i=o.children(".ps-js-comment-more"),s=i.find(".ps-js-loading");return e.Deferred(function(r){!function r(c){var a=o.children(".cstream-comment:first");s.removeClass("hidden"),t.postJson("activity.show_previous_comments",{act_id:n,uid:peepsodata.currentuserid,all:1,first:a.data("comment-id")},function(n){var o=t.observer.applyFilters("peepso_activity_content",n.data.html);s.addClass("hidden"),a.before(o),n.data.comments_remain>0?(i.find("a").html(n.data.comments_remain_caption),r(c)):(i.remove(),e(document).trigger("ps_comment_added"),c())})}(function(){r.resolve()})})},reveal_comment:function(t,n){return e.Deferred(e.proxy(function(o){e("#comment-item-"+n).length?o.resolve():this.show_all(t).done(e.proxy(function(){o.resolve()},this))},this))},reveal:function(t,n,o,i){function s(t){var n=t.find("a.ps-comment-user").eq(0).css("color"),o=t.offset().top-(e(window).height()-t.outerHeight())/2;t.css({backgroundColor:n}),t.css({transition:"background-color 2s ease"}),e("html, body").delay(50).animate({scrollTop:o},500,function(){t.css({backgroundColor:""})})}this.reveal_comment(t,n).done(e.proxy(function(){i?this.reveal_comment(o,i).done(function(){s(e("#comment-item-"+i))}):s(e("#comment-item-"+n))},this))}}),n}(e,t))}(jQuery,peepso);