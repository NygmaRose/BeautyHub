!function(e,t){var a,i,s="PsAvatar",r=(a=s,i=e.jQuery,peepso.createClass(a,peepso.npm.EventEmitter,{__constructor:function(e){this._useGravatar=!1,this._isTemp=!1,this.$file=this._uploadInit(e)},uploadUrl:peepsodata.ajaxurl_legacy+"profile.upload_avatar?avatar",uploadParams:function(){return{user_id:peepsodata.userid,_wpnonce:peepsodata.avatar.uploadNonce}},upload:function(){this.$file&&this.$file.click()},_uploadInit:function(e){var t,a;return e?a=i(e):((t=i('<div class="ps-js-uploader-avatar" />').css({position:"absolute",left:0,top:-999})).html('<input type="file" name="filedata" accept="image/*" />'),t.appendTo(document.body),a=t.find("input")),a.fileupload({url:this.uploadUrl,formData:this.uploadParams(),replaceFileInput:!1,dataType:"json",add:i.proxy(function(e,t){var a=peepsodata.avatar,i=t.files[0];/(\.|\/)(gif|jpe?g|png)$/i.test(i.type)?parseInt(i.size)>a.uploadMaxSize?this.emit("uploadfail",a.textErrorFileSize):t.submit():this.emit("uploadfail",a.textErrorFileType)},this),submit:i.proxy(function(){this.emit("uploadsubmit")},this),done:i.proxy(function(e,t){var a,i,s=t.result;s.success?(a=s.data&&s.data.image_url,i=s.data&&s.data.orig_image_url,this._useGravatar=!1,this._isTemp=!0,this.emit("uploaddone",a,i)):this.emit("uploadfail",s.errors)},this)}),a},crop:function(e,t,a,s,r,o){return i.Deferred(i.proxy(function(p){peepso.postJson("profile.crop",{user_id:peepsodata.userid,x:e,y:t,x2:a,y2:s,width:r,height:o,tmp:this._isTemp?1:0,_wpnonce:peepsodata.avatar.uploadNonce},i.proxy(function(e){e&&e.success?p.resolveWith(this,[e.data&&e.data.image_url]):p.rejectWith(this)},this))},this))},remove:function(){return i.Deferred(i.proxy(function(e){peepso.postJson("profile.remove_avatar",{uid:peepsodata.currentuserid,user_id:peepsodata.userid,_wpnonce:peepsodata.avatar.uploadNonce},i.proxy(function(t){t&&t.success?e.resolveWith(this,[t.data&&t.data.image_url]):e.rejectWith(this)},this))},this))},useGravatar:function(){return i.Deferred(i.proxy(function(e){peepso.postJson("profile.use_gravatar",{uid:peepsodata.currentuserid,user_id:peepsodata.userid,_wpnonce:peepsodata.avatar.uploadNonce},i.proxy(function(t){t&&t.success?(this._useGravatar=!0,e.resolveWith(this,[t.data&&t.data.image_url])):e.rejectWith(this)},this))},this))},finalize:function(){return i.Deferred(i.proxy(function(e){peepso.postJson("profile.confirm_avatar",{uid:peepsodata.currentuserid,user_id:peepsodata.userid,use_gravatar:this._useGravatar?1:0,_wpnonce:peepsodata.avatar.uploadNonce},i.proxy(function(t){t&&t.success?e.resolveWith(this):e.rejectWith(this)},this))},this))}}));"object"==typeof module&&module.exports?module.exports=r:e[s]=r}(window);